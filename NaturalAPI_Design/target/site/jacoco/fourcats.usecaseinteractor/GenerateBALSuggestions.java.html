<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GenerateBALSuggestions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">NaturalAPI_Design</a> &gt; <a href="index.source.html" class="el_package">fourcats.usecaseinteractor</a> &gt; <span class="el_source">GenerateBALSuggestions.java</span></div><h1>GenerateBALSuggestions.java</h1><pre class="source lang-java linenums">package fourcats.usecaseinteractor;

import fourcats.datastructure.AnalyzedData;
import fourcats.entities.Action;
import fourcats.entities.ObjectParam;
import fourcats.entities.Scenario;
import fourcats.interfaceaccess.RepositoryAccess;
import fourcats.interfaceaccess.TextAnalyzer;
import fourcats.port.GenerateBALSuggestionsInputPort;
import fourcats.port.GenerateBALSuggestionsOutputPort;

import java.io.FileNotFoundException;
import java.util.*;
import java.util.stream.*;

public class GenerateBALSuggestions implements GenerateBALSuggestionsInputPort {
    RepositoryAccess repo;
    TextAnalyzer textAnalyzer;
    GenerateBALSuggestionsOutputPort out;
    private static final String AS_A = &quot;As a&quot;;

    public GenerateBALSuggestions(RepositoryAccess repositoryAccess, TextAnalyzer textAnalyzer, GenerateBALSuggestionsOutputPort outputPort)
<span class="fc" id="L23">    {</span>
<span class="fc" id="L24">        this.repo = repositoryAccess;</span>
<span class="fc" id="L25">        this.textAnalyzer = textAnalyzer;</span>
<span class="fc" id="L26">        this.out = outputPort;</span>
<span class="fc" id="L27">    }</span>

    public void generateSuggestions(String featureFileName) {
        Map&lt;Integer,Action&gt; mActions;
        //BlackList blackList = new BlackList();
<span class="fc" id="L32">        List&lt;Scenario&gt; lScenarios = new ArrayList&lt;&gt;();</span>
        List&lt;Action&gt; lGeneratedActions;
<span class="fc" id="L34">        int id = 0;</span>
<span class="fc" id="L35">        String feature = &quot;&quot;;</span>
        //read feature file from repository
        try {
<span class="fc" id="L38">            feature = repo.read(featureFileName);</span>
        }
<span class="nc" id="L40">        catch(FileNotFoundException e){</span>
<span class="nc" id="L41">            out.showErrorFileLoad();</span>
<span class="nc" id="L42">            return;</span>
<span class="fc" id="L43">        }</span>
<span class="pc bpc" id="L44" title="1 of 2 branches missed.">        if(feature!=null) {</span>
<span class="nc" id="L45">            String[] arrScenarios = feature.split(&quot;Scenario:&quot;); //split all scenarios to different strings</span>
<span class="nc bnc" id="L46" title="All 2 branches missed.">            for (String currentScenario : Arrays.asList(arrScenarios).subList(1, arrScenarios.length)) {</span>
<span class="nc" id="L47">                lGeneratedActions = generateAction(currentScenario);</span>
<span class="nc" id="L48">                mActions = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">                for (Action action : lGeneratedActions) {</span>
<span class="nc" id="L50">                    mActions.put(id, action);</span>
<span class="nc" id="L51">                    id++;</span>
<span class="nc" id="L52">                }</span>

<span class="nc" id="L54">                lScenarios.add(new Scenario(extractScenarioName(currentScenario), mActions, currentScenario, extractActorName(feature))); //add Scenario with relative suggestions</span>
<span class="nc" id="L55">            }</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">            for (Scenario scenario : lScenarios) {</span>
<span class="nc" id="L57">                repo.createScenario(scenario); //add each scenario (which contains the suggestions) to the repository</span>
<span class="nc" id="L58">            }</span>
<span class="nc" id="L59">            out.showSuggestionsForScenario(repo.readScenarios());</span>
        }

<span class="fc" id="L62">    }</span>

    private List&lt;Action&gt; generateAction(String scenario)  {
<span class="nc" id="L65">        List&lt;Action&gt; lGeneratedAction = new ArrayList&lt;&gt;();</span>
        // analyze the content of the retrieved file
<span class="nc" id="L67">        AnalyzedData analyzedData = textAnalyzer.parseDocumentContent(scenario);</span>
        //add each suggestion to the suggestions list with a default parameter (the name in the action)
        //format the suggestion by adding &quot;_&quot; between words
        //ex. withdraw cash --&gt; withdraw_cash
<span class="nc" id="L71">        String formattedSuggestion=&quot;&quot;;</span>
<span class="nc" id="L72">        Action suggestion = null;</span>

<span class="nc" id="L74">        List&lt;String&gt; predicates = analyzedData.getDependenciesList()</span>
<span class="nc" id="L75">                .stream()</span>
<span class="nc" id="L76">                .filter(d-&gt;(d.getRelation().equals(&quot;dobj&quot;)))</span>
<span class="nc" id="L77">                .map(d-&gt; d.getGov()+&quot; &quot;+d.getDep())</span>
<span class="nc" id="L78">                .collect(Collectors.toList());</span>

<span class="nc bnc" id="L80" title="All 2 branches missed.">        for (String suggestedAction : predicates){</span>
<span class="nc" id="L81">            formattedSuggestion = suggestedAction.replace(&quot; &quot;, &quot;_&quot;);</span>
<span class="nc" id="L82">            suggestion = new Action((formattedSuggestion), &quot;void&quot;);</span>
<span class="nc" id="L83">            suggestion.addObjectParam(generateObject(suggestion.getName()));</span>
<span class="nc" id="L84">            lGeneratedAction.add(suggestion);</span>
<span class="nc" id="L85">        }</span>
<span class="nc" id="L86">        return lGeneratedAction;</span>

    }

    //generate default objectParameter (the first parameter in the Action)
    private ObjectParam generateObject(String actionName){
<span class="nc" id="L92">        String[] splittedActionName = actionName.split(&quot;_&quot;);</span>
<span class="nc" id="L93">        return new ObjectParam(splittedActionName[1],&quot;string&quot;); //object type default at string</span>
    }

    private String extractScenarioName(String feature){
//extract scenario name by picking the text between first row and &quot;Given:&quot; in the feature file
<span class="nc" id="L98">        int indexFeatureStart = 1;</span>
<span class="nc" id="L99">        int indexFeatureEnd = -1;</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">        if (feature.indexOf(AS_A)!=-1)</span>
<span class="nc" id="L101">            indexFeatureEnd = feature.indexOf(AS_A);</span>
        else
<span class="nc" id="L103">            indexFeatureEnd = feature.indexOf(&quot;Given&quot;);</span>
<span class="nc" id="L104">        return feature.substring(indexFeatureStart,indexFeatureEnd).trim();</span>

    }

    private String extractActorName(String feature){
        //extract actor name by picking the text between keywords &quot;As a&quot; and &quot;Scenario&quot; in the feature file
        //if there isn't the keyword &quot;As as&quot; return &quot;All&quot;
<span class="nc" id="L111">        int indexActorStart = -1;</span>
<span class="nc" id="L112">        int indexActorEnd = 0;</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (feature.indexOf(AS_A)!=-1) {</span>
<span class="nc" id="L114">            indexActorStart = feature.indexOf(AS_A)+5;</span>
<span class="nc" id="L115">            indexActorEnd = feature.indexOf(&quot;Scenario&quot;);</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">            if (indexActorStart &lt;= indexActorEnd)</span>
<span class="nc" id="L117">                return feature.substring(indexActorStart,indexActorEnd).trim();</span>
        }
<span class="nc" id="L119">        return &quot;All&quot;;</span>

    }



}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>